<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Silicon Labs Bluetooth API: Device Firmware Update</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Silicon Labs Bluetooth API
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__sl__bt__dfu.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">Modules</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Device Firmware Update</div>  </div>
</div><!--header-->
<div class="contents">

<p>Device Firmware Update.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
Modules</h2></td></tr>
<tr class="memitem:group__sl__bt__evt__dfu__boot"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__sl__bt__evt__dfu__boot.html">sl_bt_evt_dfu_boot</a></td></tr>
<tr class="memdesc:group__sl__bt__evt__dfu__boot"><td class="mdescLeft">&#160;</td><td class="mdescRight">This event indicates that the device booted in DFU mode and is now ready to receive commands related to device firmware upgrade (DFU). <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__sl__bt__evt__dfu__boot__failure"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__sl__bt__evt__dfu__boot__failure.html">sl_bt_evt_dfu_boot_failure</a></td></tr>
<tr class="memdesc:group__sl__bt__evt__dfu__boot__failure"><td class="mdescLeft">&#160;</td><td class="mdescRight">This event indicates that an error, which prevents the device from booting, has occurred in bootloader. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga1611c1f1919c75eda90a95eb2ab05615"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__sl__bt__dfu.html#ga1611c1f1919c75eda90a95eb2ab05615">sl_bt_dfu_reset</a> (uint8_t dfu)</td></tr>
<tr class="separator:ga1611c1f1919c75eda90a95eb2ab05615"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga66fb3a7dc1534699a77d39c0d61454ef"><td class="memItemLeft" align="right" valign="top">sl_status_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__sl__bt__dfu.html#ga66fb3a7dc1534699a77d39c0d61454ef">sl_bt_dfu_flash_set_address</a> (uint32_t address)</td></tr>
<tr class="separator:ga66fb3a7dc1534699a77d39c0d61454ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaae6af5fa0670bab4c6b2c35db0df8035"><td class="memItemLeft" align="right" valign="top">sl_status_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__sl__bt__dfu.html#gaae6af5fa0670bab4c6b2c35db0df8035">sl_bt_dfu_flash_upload</a> (size_t data_len, const uint8_t *data)</td></tr>
<tr class="separator:gaae6af5fa0670bab4c6b2c35db0df8035"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga32177d5889b6d95692a6f6321f00de43"><td class="memItemLeft" align="right" valign="top">sl_status_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__sl__bt__dfu.html#ga32177d5889b6d95692a6f6321f00de43">sl_bt_dfu_flash_upload_finish</a> ()</td></tr>
<tr class="separator:ga32177d5889b6d95692a6f6321f00de43"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Device Firmware Update. </p>
<p>These commands and events are related to controlling firmware updates over the configured host interface and are available only when the device is booted in DFU mode. <b>DFU process:</b></p><ol type="1">
<li>Boot device to DFU mode with <a class="el" href="group__sl__bt__dfu.html#ga1611c1f1919c75eda90a95eb2ab05615">sl_bt_dfu_reset</a> command</li>
<li>Wait for <a class="el" href="group__sl__bt__evt__dfu__boot.html">sl_bt_evt_dfu_boot</a> event</li>
<li>Send command <a class="el" href="group__sl__bt__dfu.html#ga66fb3a7dc1534699a77d39c0d61454ef">sl_bt_dfu_flash_set_address</a> command to start the firmware update</li>
<li>Upload the firmware with <a class="el" href="group__sl__bt__dfu.html#gaae6af5fa0670bab4c6b2c35db0df8035">sl_bt_dfu_flash_upload</a> commands until all data is uploaded</li>
<li>Send <a class="el" href="group__sl__bt__dfu.html#ga32177d5889b6d95692a6f6321f00de43">sl_bt_dfu_flash_upload_finish</a> command when all data is uploaded</li>
<li>Finalize DFU firmware update with <a class="el" href="group__sl__bt__dfu.html#ga1611c1f1919c75eda90a95eb2ab05615">sl_bt_dfu_reset</a> command</li>
</ol>
<p>DFU mode is using the UART baudrate set in bootloader. </p>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga1611c1f1919c75eda90a95eb2ab05615"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga1611c1f1919c75eda90a95eb2ab05615">&#9670;&nbsp;</a></span>sl_bt_dfu_reset()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sl_bt_dfu_reset </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>dfu</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Reset the system. The command does not have a response but it triggers one of the boot events (normal reset or boot to DFU mode) after re-boot.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">dfu</td><td>Enum <a class="el" href="group__sl__bt__system.html#gae5c9da28618277856cdacb3054a54993">system_boot_mode_t</a>. Boot mode. Values:<ul>
<li><b>system_boot_mode_normal (0x0):</b> Boot to normal mode</li>
<li><b>system_boot_mode_uart_dfu (0x1):</b> Boot to UART DFU mode</li>
<li><b>system_boot_mode_ota_dfu (0x2):</b> Boot to OTA DFU mode</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<p><b>Events</b> </p><ul>
<li><a class="el" href="group__sl__bt__evt__system__boot.html">sl_bt_evt_system_boot</a> - Sent after the device has booted in normal mode</li>
<li><a class="el" href="group__sl__bt__evt__dfu__boot.html">sl_bt_evt_dfu_boot</a> - Sent after the device has booted in UART DFU mode </li>
</ul>

</div>
</div>
<a id="ga66fb3a7dc1534699a77d39c0d61454ef"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga66fb3a7dc1534699a77d39c0d61454ef">&#9670;&nbsp;</a></span>sl_bt_dfu_flash_set_address()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">sl_status_t sl_bt_dfu_flash_set_address </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>address</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>After re-booting the local device in DFU mode, this command defines the starting address on the flash where the new firmware will be written.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">address</td><td>The offset in the flash where the new firmware is uploaded to. Always use the value 0x00000000.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>SL_STATUS_OK if successful. Error code otherwise. </dd></dl>

</div>
</div>
<a id="gaae6af5fa0670bab4c6b2c35db0df8035"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaae6af5fa0670bab4c6b2c35db0df8035">&#9670;&nbsp;</a></span>sl_bt_dfu_flash_upload()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">sl_status_t sl_bt_dfu_flash_upload </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>data_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Upload the whole firmware image file into the Bluetooth device. The passed data length must be a multiple of 4 bytes. Because the BGAPI command payload size is limited, multiple commands need to be issued one after the other until the whole .bin firmware image file is uploaded to the device. After each command, the next address of the flash sector in memory to write to is automatically updated by the bootloader.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">data_len</td><td>Array length </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">data</td><td>An array of data which will be written onto the flash.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>SL_STATUS_OK if successful. Error code otherwise. </dd></dl>

</div>
</div>
<a id="ga32177d5889b6d95692a6f6321f00de43"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga32177d5889b6d95692a6f6321f00de43">&#9670;&nbsp;</a></span>sl_bt_dfu_flash_upload_finish()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">sl_status_t sl_bt_dfu_flash_upload_finish </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Inform the device that the DFU file is fully uploaded. To return the device back to normal mode, issue the command <a class="el" href="group__sl__bt__dfu.html#ga1611c1f1919c75eda90a95eb2ab05615">sl_bt_dfu_reset</a>.</p>
<dl class="section return"><dt>Returns</dt><dd>SL_STATUS_OK if successful. Error code otherwise. </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
